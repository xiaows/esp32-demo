<!DOCTYPE html>
<html>
<head>
    <title>ESP32 æ— çº¿ç¼–ç¨‹å™¨</title>
    <meta charset="utf-8">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .content {
            display: flex;
            min-height: 600px;
        }
        
        .editor-section {
            flex: 3;
            display: flex;
            flex-direction: column;
        }
        
        .control-section {
            flex: 1;
            background: #f8f9fa;
            padding: 20px;
            border-left: 1px solid #ddd;
            display: flex;
            flex-direction: column;
        }
        
        .editor-toolbar {
            background: #34495e;
            color: white;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .editor-container {
            flex: 1;
            position: relative;
        }
        
        #codeEditor {
            width: 100%;
            height: 100%;
            border: none;
            padding: 15px;
            font-family: 'Consolas', monospace;
            font-size: 14px;
            line-height: 1.5;
            resize: none;
            outline: none;
        }
        
        .status-bar {
            background: #ecf0f1;
            padding: 10px;
            border-top: 1px solid #ddd;
            font-size: 12px;
            color: #7f8c8d;
        }
        
        .control-group {
            margin-bottom: 20px;
        }
        
        .control-group h3 {
            margin-bottom: 10px;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 5px;
        }
        
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
            margin: 5px 0;
            width: 100%;
        }
        
        button:hover {
            background: #2980b9;
        }
        
        button:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }
        
        .btn-success {
            background: #27ae60;
        }
        
        .btn-success:hover {
            background: #219653;
        }
        
        .btn-danger {
            background: #e74c3c;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-warning {
            background: #f39c12;
        }
        
        .btn-warning:hover {
            background: #d68910;
        }
        
        .connection-status {
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .connected {
            background: #d5f4e6;
            color: #27ae60;
            border: 1px solid #2ecc71;
        }
        
        .disconnected {
            background: #ffeaea;
            color: #e74c3c;
            border: 1px solid #e74c3c;
        }
        
        .log-container {
            flex: 1;
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            overflow-y: auto;
            font-family: 'Consolas', monospace;
            font-size: 12px;
            margin-top: 10px;
        }
        
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #3498db;
            background: #f8f9fa;
        }
        
        .log-error {
            border-left-color: #e74c3c;
            background: #ffeaea;
        }
        
        .log-success {
            border-left-color: #27ae60;
            background: #d5f4e6;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #ecf0f1;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
            display: none;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            width: 0%;
            transition: width 0.3s;
            text-align: center;
            color: white;
            line-height: 20px;
            font-size: 12px;
        }
        
        .file-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-top: 10px;
        }
        
        .file-item {
            padding: 8px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .file-item:hover {
            background: #f0f7ff;
        }
        
        .file-name {
            font-family: 'Consolas', monospace;
            font-size: 13px;
        }
        
        .file-size {
            color: #7f8c8d;
            font-size: 11px;
        }
        
        .delete-file {
            color: #e74c3c;
            cursor: pointer;
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 3px;
        }
        
        .delete-file:hover {
            background: #ffeaea;
        }
        
        .examples {
            margin-top: 15px;
        }
        
        .example-btn {
            background: #9b59b6;
            margin: 2px;
            width: calc(50% - 4px);
            display: inline-block;
            padding: 8px;
            font-size: 12px;
        }
        
        .example-btn:hover {
            background: #8e44ad;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 400px;
        }
        
        .modal input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .tab-container {
            display: flex;
            border-bottom: 1px solid #ddd;
            background: #f8f9fa;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-right: 1px solid #ddd;
        }
        
        .tab.active {
            background: white;
            border-bottom: 2px solid #3498db;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“¡ ESP32 æ— çº¿ç¼–ç¨‹å™¨</h1>
            <p>é€šè¿‡è“ç‰™ç»™ESP32å‘é€å¹¶æ‰§è¡ŒPythonä»£ç </p>
        </div>
        
        <div class="content">
            <div class="editor-section">
                <div class="tab-container">
                    <div class="tab active" onclick="switchTab('editor')">ä»£ç ç¼–è¾‘å™¨</div>
                    <div class="tab" onclick="switchTab('terminal')">ç»ˆç«¯è¾“å‡º</div>
                </div>
                
                <div id="editorTab" class="editor-container">
                    <textarea id="codeEditor" style="width: 100%; height: 100%; background: #1e1e1e; color: #d4d4d4; font-family: 'Consolas', monospace; font-size: 14px; padding: 15px; border: none; resize: none; outline: none;"># ESP32 MicroPython ä»£ç ç¼–è¾‘å™¨
# é€šè¿‡è“ç‰™æ— çº¿ç¼–ç¨‹

from machine import Pin
import time

led = Pin(2, Pin.OUT)

while True:
    led.value(not led.value())
    time.sleep(0.5)</textarea>
                </div>
                
                <div id="terminalTab" class="editor-container" style="display: none;">
                    <div class="log-container" id="terminalOutput"></div>
                </div>
                
                <div class="status-bar">
                    <span id="statusText">æœªè¿æ¥</span>
                    <span style="float: right;">
                        è¡Œ: <span id="lineNumber">1</span>, 
                        åˆ—: <span id="columnNumber">1</span>
                    </span>
                </div>
            </div>
            
            <div class="control-section">
                <div class="connection-status disconnected" id="connectionStatus">
                    ğŸ”´ æœªè¿æ¥åˆ° ESP32
                </div>
                
                <div class="progress-bar" id="progressBar">
                    <div class="progress-fill" id="progressFill">0%</div>
                </div>
                
                <div class="control-group">
                    <h3>ğŸ“¡ è¿æ¥æ§åˆ¶</h3>
                    <button id="connectBtn" onclick="connectDevice()">æ‰«æå¹¶è¿æ¥è®¾å¤‡</button>
                    <button id="disconnectBtn" onclick="disconnectDevice()" disabled>æ–­å¼€è¿æ¥</button>
                </div>
                
                <div class="control-group">
                    <h3>ğŸ’¾ æ–‡ä»¶æ“ä½œ</h3>
                    <button onclick="saveCode()" id="saveBtn" disabled>ä¿å­˜ä»£ç åˆ°ESP32</button>
                    <button onclick="listFiles()" id="listBtn" disabled>åˆ—å‡ºæ–‡ä»¶</button>
                    <button onclick="runCode()" id="runBtn" disabled>â–¶ æ‰§è¡Œä»£ç </button>
                    <button onclick="uploadFile()" id="uploadBtn" disabled>ğŸ“¤ ä¸Šä¼ æ–‡ä»¶</button>
                </div>
                
                <div class="control-group">
                    <h3>ğŸ“ æ–‡ä»¶åˆ—è¡¨</h3>
                    <div class="file-list" id="fileList">
                        <div style="padding: 10px; color: #7f8c8d; text-align: center;">
                            ç‚¹å‡»"åˆ—å‡ºæ–‡ä»¶"æŸ¥çœ‹
                        </div>
                    </div>
                </div>
                
                <div class="control-group">
                    <h3>âš™ï¸ ç³»ç»Ÿå‘½ä»¤</h3>
                    <button onclick="getSystemInfo()" id="infoBtn" disabled>ç³»ç»Ÿä¿¡æ¯</button>
                    <button onclick="restartESP32()" id="restartBtn" disabled class="btn-warning">é‡å¯ESP32</button>
                    <button onclick="clearEditor()" class="btn-danger">æ¸…ç©ºç¼–è¾‘å™¨</button>
                </div>
                
                <div class="examples">
                    <h3>ğŸ¯ ç¤ºä¾‹ä»£ç </h3>
                    <button class="example-btn" onclick="loadExample('blink')">LEDé—ªçƒ</button>
                    <button class="example-btn" onclick="loadExample('sensor')">è¯»å–ä¼ æ„Ÿå™¨</button>
                    <button class="example-btn" onclick="loadExample('wifi')">WiFiè¿æ¥</button>
                    <button class="example-btn" onclick="loadExample('http')">HTTPæœåŠ¡å™¨</button>
                </div>
                
                <div class="control-group">
                    <h3>ğŸ“Š è¾“å‡ºæ—¥å¿—</h3>
                    <div class="log-container" id="outputLog"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- æ–‡ä»¶åè¾“å…¥æ¨¡æ€æ¡† -->
    <div class="modal" id="fileNameModal">
        <div class="modal-content">
            <h3>ä¿å­˜æ–‡ä»¶</h3>
            <p>è¾“å…¥æ–‡ä»¶åï¼ˆä¾‹å¦‚ï¼šmain.py, script.pyï¼‰</p>
            <input type="text" id="fileNameInput" placeholder="main.py" value="main.py">
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button onclick="confirmSave()" style="flex: 1;" class="btn-success">ä¿å­˜</button>
                <button onclick="cancelSave()" style="flex: 1;" class="btn-danger">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <script>
        // BLEé…ç½® (Web Bluetooth è¦æ±‚ UUID å¿…é¡»å°å†™)
        const SERVICE_UUID = '6e400001-b5a3-f393-e0a9-e50e24dcca9e';
        const RX_CHARACTERISTIC_UUID = '6e400002-b5a3-f393-e0a9-e50e24dcca9e';
        const TX_CHARACTERISTIC_UUID = '6e400003-b5a3-f393-e0a9-e50e24dcca9e';
        const CODE_CHARACTERISTIC_UUID = '6e400004-b5a3-f393-e0a9-e50e24dcca9e';
        
        // å…¨å±€å˜é‡
        let device = null;
        let server = null;
        let service = null;
        let rxCharacteristic = null;  // å‘é€å‘½ä»¤
        let txCharacteristic = null;  // æ¥æ”¶å“åº”
        let codeCharacteristic = null; // å¤§æ–‡ä»¶ä¼ è¾“
        let isConnected = false;

        // ç¼–è¾‘å™¨å¼•ç”¨
        const editor = document.getElementById('codeEditor');

        // ç›‘å¬å…‰æ ‡ä½ç½®å˜åŒ–
        editor.addEventListener('click', updateCursorPosition);
        editor.addEventListener('keyup', updateCursorPosition);

        function updateCursorPosition() {
            const text = editor.value.substring(0, editor.selectionStart);
            const lines = text.split('\n');
            document.getElementById('lineNumber').textContent = lines.length;
            document.getElementById('columnNumber').textContent = lines[lines.length - 1].length + 1;
        }
        
        // æ ‡ç­¾åˆ‡æ¢
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById('editorTab').style.display = 'none';
            document.getElementById('terminalTab').style.display = 'none';
            
            if (tabName === 'editor') {
                document.querySelector('.tab:nth-child(1)').classList.add('active');
                document.getElementById('editorTab').style.display = 'block';
            } else {
                document.querySelector('.tab:nth-child(2)').classList.add('active');
                document.getElementById('terminalTab').style.display = 'block';
            }
        }
        
        // è¿æ¥è®¾å¤‡
        async function connectDevice() {
            try {
                logMessage('æ­£åœ¨æ‰«æESP32è®¾å¤‡...', 'info');
                
                device = await navigator.bluetooth.requestDevice({
                    acceptAllDevices: true,
                    optionalServices: [SERVICE_UUID]
                });
                
                logMessage(`æ‰¾åˆ°è®¾å¤‡: ${device.name || device.id}`, 'success');
                
                // è¿æ¥GATTæœåŠ¡å™¨
                logMessage('æ­£åœ¨è¿æ¥...', 'info');
                server = await device.gatt.connect();
                
                // è·å–æœåŠ¡
                service = await server.getPrimaryService(SERVICE_UUID);
                
                // è·å–ç‰¹å¾
                rxCharacteristic = await service.getCharacteristic(RX_CHARACTERISTIC_UUID);
                txCharacteristic = await service.getCharacteristic(TX_CHARACTERISTIC_UUID);
                codeCharacteristic = await service.getCharacteristic(CODE_CHARACTERISTIC_UUID);
                
                // ç›‘å¬é€šçŸ¥
                await txCharacteristic.startNotifications();
                txCharacteristic.addEventListener('characteristicvaluechanged', handleResponse);
                
                // æ›´æ–°è¿æ¥çŠ¶æ€
                isConnected = true;
                updateConnectionStatus(true);
                
                logMessage('è¿æ¥æˆåŠŸï¼', 'success');
                
                // å¯ç”¨æ§åˆ¶æŒ‰é’®
                enableControls(true);
                
                // ç›‘å¬æ–­å¼€äº‹ä»¶
                device.addEventListener('gattserverdisconnected', onDisconnected);
                
            } catch (error) {
                logMessage(`è¿æ¥å¤±è´¥: ${error.message}`, 'error');
                updateConnectionStatus(false);
            }
        }
        
        // æ–­å¼€è¿æ¥
        async function disconnectDevice() {
            if (device && device.gatt.connected) {
                try {
                    await device.gatt.disconnect();
                    logMessage('å·²æ–­å¼€è¿æ¥', 'info');
                } catch (error) {
                    logMessage(`æ–­å¼€è¿æ¥å¤±è´¥: ${error.message}`, 'error');
                }
            }
            onDisconnected();
        }
        
        // æ–­å¼€å¤„ç†
        function onDisconnected() {
            isConnected = false;
            device = null;
            server = null;
            service = null;
            rxCharacteristic = null;
            txCharacteristic = null;
            codeCharacteristic = null;
            
            updateConnectionStatus(false);
            enableControls(false);
            logMessage('è®¾å¤‡å·²æ–­å¼€', 'error');
        }
        
        // å‘é€å‘½ä»¤åˆ°ESP32
        async function sendCommand(command) {
            if (!isConnected || !rxCharacteristic) {
                logMessage('é”™è¯¯ï¼šæœªè¿æ¥åˆ°è®¾å¤‡', 'error');
                return null;
            }
            
            try {
                const commandStr = JSON.stringify(command);
                const encoder = new TextEncoder();
                const data = encoder.encode(commandStr);
                
                await rxCharacteristic.writeValue(data);
                logMessage(`å‘é€å‘½ä»¤: ${command.type}`, 'info');
                
            } catch (error) {
                logMessage(`å‘é€å¤±è´¥: ${error.message}`, 'error');
                return null;
            }
        }
        
        // å‘é€å¤§æ–‡ä»¶æ•°æ®
        async function sendFileData(data) {
            if (!isConnected || !codeCharacteristic) {
                throw new Error('æœªè¿æ¥åˆ°è®¾å¤‡');
            }
            
            const encoder = new TextEncoder();
            const buffer = encoder.encode(data);
            
            // åˆ†å—å‘é€ï¼ˆé¿å…MTUé™åˆ¶ï¼‰
            const chunkSize = 512; // BLE MTUé€šå¸¸ä¸º512å­—èŠ‚
            for (let i = 0; i < buffer.length; i += chunkSize) {
                const chunk = buffer.slice(i, i + chunkSize);
                await codeCharacteristic.writeValue(chunk);
                
                // æ›´æ–°è¿›åº¦
                const progress = Math.min((i + chunk.length) / buffer.length * 100, 100);
                updateProgress(progress);
                
                // ç¨å¾®å»¶è¿Ÿï¼Œé¿å…é˜»å¡
                await new Promise(resolve => setTimeout(resolve, 10));
            }
        }
        
        // å¤„ç†ESP32å“åº”
        function handleResponse(event) {
            const value = event.target.value;
            const decoder = new TextDecoder('utf-8');
            const dataStr = decoder.decode(value);
            
            try {
                const response = JSON.parse(dataStr.trim());
                processResponse(response);
            } catch (error) {
                logMessage(`æ¥æ”¶æ•°æ®: ${dataStr}`, 'info');
            }
        }
        
        // å¤„ç†å“åº”
        function processResponse(response) {
            const status = response.status;
            const message = response.message;
            const data = response.data;
            
            switch (status) {
                case 'CONNECTED':
                    logMessage(message, 'success');
                    break;
                    
                case 'SUCCESS':
                    logMessage(`âœ“ ${message}`, 'success');
                    if (data && data.files) {
                        displayFileList(data.files);
                    }
                    if (data && data.result) {
                        displayExecutionResult(data.result);
                    }
                    break;
                    
                case 'ERROR':
                    logMessage(`âœ— ${message}`, 'error');
                    break;
                    
                case 'INFO':
                    logMessage(`â„¹ ${message}`, 'info');
                    break;
                    
                case 'READY':
                    logMessage(`å‡†å¤‡æ¥æ”¶æ–‡ä»¶: ${data.filename}`, 'info');
                    startFileUpload(data.filename);
                    break;
                    
                case 'PROGRESS':
                    updateProgress(data.progress);
                    break;
                    
                default:
                    logMessage(`æœªçŸ¥å“åº”: ${status} - ${message}`, 'info');
            }
        }
        
        // ä¿å­˜ä»£ç 
        async function saveCode() {
            const code = editor.value;
            if (!code.trim()) {
                alert('è¯·è¾“å…¥ä»£ç ');
                return;
            }
            
            // æ˜¾ç¤ºæ–‡ä»¶åè¾“å…¥æ¡†
            document.getElementById('fileNameModal').style.display = 'flex';
            window.confirmSaveCallback = async () => {
                const filename = document.getElementById('fileNameInput').value.trim();
                if (!filename) {
                    alert('è¯·è¾“å…¥æ–‡ä»¶å');
                    return;
                }
                
                if (!filename.endsWith('.py')) {
                    alert('æ–‡ä»¶ååº”ä»¥ .py ç»“å°¾');
                    return;
                }
                
                await sendCommand({
                    type: 'save',
                    code: code,
                    filename: filename
                });
                
                document.getElementById('fileNameModal').style.display = 'none';
            };
        }
        
        // ç¡®è®¤ä¿å­˜
        function confirmSave() {
            if (window.confirmSaveCallback) {
                window.confirmSaveCallback();
            }
        }
        
        // å–æ¶ˆä¿å­˜
        function cancelSave() {
            document.getElementById('fileNameModal').style.display = 'none';
            window.confirmSaveCallback = null;
        }
        
        // è¿è¡Œä»£ç 
        async function runCode() {
            const code = editor.value;
            if (!code.trim()) {
                alert('è¯·è¾“å…¥ä»£ç ');
                return;
            }
            
            await sendCommand({
                type: 'run',
                code: code
            });
        }
        
        // ä¸Šä¼ æ–‡ä»¶ï¼ˆå¤§æ–‡ä»¶ï¼‰
        async function uploadFile() {
            const code = editor.value;
            if (!code.trim()) {
                alert('è¯·è¾“å…¥ä»£ç ');
                return;
            }
            
            const filename = prompt('è¾“å…¥æ–‡ä»¶å:', 'main.py');
            if (!filename) return;
            
            // å‘é€å¼€å§‹ä¸Šä¼ å‘½ä»¤
            await sendCommand({
                type: 'start_upload',
                filename: filename,
                size: code.length
            });
        }
        
        // å¼€å§‹æ–‡ä»¶ä¸Šä¼ 
        async function startFileUpload(filename) {
            const code = editor.value;
            
            try {
                showProgressBar(true);
                await sendFileData(code);
                showProgressBar(false);
                
                logMessage(`æ–‡ä»¶ä¸Šä¼ å®Œæˆ: ${filename}`, 'success');
                
            } catch (error) {
                logMessage(`ä¸Šä¼ å¤±è´¥: ${error.message}`, 'error');
                showProgressBar(false);
            }
        }
        
        // åˆ—å‡ºæ–‡ä»¶
        async function listFiles() {
            await sendCommand({ type: 'list' });
        }
        
        // åˆ é™¤æ–‡ä»¶
        async function deleteFile(filename) {
            if (confirm(`ç¡®å®šåˆ é™¤ ${filename} å—ï¼Ÿ`)) {
                await sendCommand({
                    type: 'delete',
                    filename: filename
                });
                // åˆ·æ–°æ–‡ä»¶åˆ—è¡¨
                setTimeout(listFiles, 1000);
            }
        }
        
        // è·å–ç³»ç»Ÿä¿¡æ¯
        async function getSystemInfo() {
            await sendCommand({ type: 'info' });
        }
        
        // é‡å¯ESP32
        async function restartESP32() {
            if (confirm('ç¡®å®šè¦é‡å¯ESP32å—ï¼Ÿ')) {
                await sendCommand({ type: 'reboot' });
            }
        }
        
        // æ¸…ç©ºç¼–è¾‘å™¨
        function clearEditor() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºç¼–è¾‘å™¨å—ï¼Ÿ')) {
                editor.value = '# æ¸…ç©ºç¼–è¾‘å™¨\n\n# å¼€å§‹ç¼–å†™ä½ çš„MicroPythonä»£ç ...';
            }
        }
        
        // åŠ è½½ç¤ºä¾‹ä»£ç 
        function loadExample(exampleName) {
            const examples = {
                blink: `# LEDé—ªçƒç¤ºä¾‹
from machine import Pin
import time

led = Pin(2, Pin.OUT)

print("å¼€å§‹LEDé—ªçƒ...")

while True:
    led.value(not led.value())
    print(f"LEDçŠ¶æ€: {led.value()}")
    time.sleep(0.5)`,

                sensor: `# ä¼ æ„Ÿå™¨è¯»å–ç¤ºä¾‹
from machine import Pin, ADC
import time

# å‡è®¾ä¼ æ„Ÿå™¨æ¥åœ¨GPIO34
sensor_pin = Pin(34, Pin.IN)
adc = ADC(sensor_pin)
adc.atten(ADC.ATTN_11DB)  # è®¾ç½®é‡ç¨‹

print("å¼€å§‹è¯»å–ä¼ æ„Ÿå™¨...")

while True:
    value = adc.read()
    voltage = value / 4095 * 3.3  # ESP32 ADCæ˜¯12ä½
    print(f"ADCå€¼: {value}, ç”µå‹: {voltage:.2f}V")
    time.sleep(1)`,

                wifi: `# WiFiè¿æ¥ç¤ºä¾‹
import network
import time

wifi_ssid = "ä½ çš„WiFiåç§°"
wifi_password = "ä½ çš„WiFiå¯†ç "

wlan = network.WLAN(network.STA_IF)
wlan.active(True)

print(f"æ­£åœ¨è¿æ¥WiFi: {wifi_ssid}")
wlan.connect(wifi_ssid, wifi_password)

# ç­‰å¾…è¿æ¥
max_wait = 10
while max_wait > 0:
    if wlan.isconnected():
        break
    max_wait -= 1
    print('ç­‰å¾…è¿æ¥...')
    time.sleep(1)

if wlan.isconnected():
    print('è¿æ¥æˆåŠŸï¼')
    print('IPåœ°å€:', wlan.ifconfig()[0])
else:
    print('è¿æ¥å¤±è´¥')`,

                http: `# ç®€å•HTTPæœåŠ¡å™¨ç¤ºä¾‹
import socket
from machine import Pin

led = Pin(2, Pin.OUT)

def handle_request(client):
    request = client.recv(1024).decode()
    
    # ç®€å•çš„è·¯ç”±
    if 'GET /led/on' in request:
        led.value(1)
        response = 'LEDå·²æ‰“å¼€'
    elif 'GET /led/off' in request:
        led.value(0)
        response = 'LEDå·²å…³é—­'
    else:
        response = '''
        <html>
        <body>
            <h1>ESP32 Web Server</h1>
            <a href="/led/on">æ‰“å¼€LED</a><br>
            <a href="/led/off">å…³é—­LED</a>
        </body>
        </html>'''
    
    # å‘é€HTTPå“åº”
    client.send('HTTP/1.1 200 OK\\r\\n')
    client.send('Content-Type: text/html\\r\\n')
    client.send('Connection: close\\r\\n\\r\\n')
    client.send(response)
    client.close()

# åˆ›å»ºæœåŠ¡å™¨
addr = socket.getaddrinfo('0.0.0.0', 80)[0][-1]
s = socket.socket()
s.bind(addr)
s.listen(1)

print('HTTPæœåŠ¡å™¨å·²å¯åŠ¨ï¼Œè®¿é—® http://<esp32-ip>/')

while True:
    client, addr = s.accept()
    print('å®¢æˆ·ç«¯è¿æ¥:', addr)
    handle_request(client)`
            };
            
            if (examples[exampleName]) {
                editor.value = examples[exampleName];
                logMessage(`å·²åŠ è½½ ${exampleName} ç¤ºä¾‹`, 'success');
            }
        }
        
        // UIæ›´æ–°å‡½æ•°
        function updateConnectionStatus(connected) {
            const statusDiv = document.getElementById('connectionStatus');
            const statusText = document.getElementById('statusText');
            
            if (connected) {
                statusDiv.className = 'connection-status connected';
                statusDiv.innerHTML = 'âœ… å·²è¿æ¥åˆ° ESP32';
                statusText.textContent = 'å·²è¿æ¥';
            } else {
                statusDiv.className = 'connection-status disconnected';
                statusDiv.innerHTML = 'ğŸ”´ æœªè¿æ¥åˆ° ESP32';
                statusText.textContent = 'æœªè¿æ¥';
            }
        }
        
        function enableControls(enabled) {
            const buttons = ['saveBtn', 'listBtn', 'runBtn', 'uploadBtn', 'infoBtn', 'restartBtn'];
            buttons.forEach(id => {
                document.getElementById(id).disabled = !enabled;
            });
            document.getElementById('disconnectBtn').disabled = !enabled;
            document.getElementById('connectBtn').disabled = enabled;
        }
        
        function logMessage(message, type = 'info') {
            const logContainer = document.getElementById('outputLog');
            const logEntry = document.createElement('div');
            
            logEntry.className = `log-entry log-${type}`;
            
            const timestamp = new Date().toLocaleTimeString();
            logEntry.innerHTML = `<span style="color: #7f8c8d;">[${timestamp}]</span> ${message}`;
            
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            // åŒæ—¶åœ¨ç»ˆç«¯æ˜¾ç¤º
            const terminal = document.getElementById('terminalOutput');
            if (terminal) {
                const terminalEntry = document.createElement('div');
                terminalEntry.textContent = `[${timestamp}] ${message}`;
                terminal.appendChild(terminalEntry);
                terminal.scrollTop = terminal.scrollHeight;
            }
        }
        
        function displayFileList(files) {
            const fileListDiv = document.getElementById('fileList');
            fileListDiv.innerHTML = '';
            
            if (files.length === 0) {
                fileListDiv.innerHTML = '<div style="padding: 10px; color: #7f8c8d; text-align: center;">æ²¡æœ‰æ–‡ä»¶</div>';
                return;
            }
            
            files.forEach(file => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                fileItem.innerHTML = `
                    <div>
                        <div class="file-name">${file.name}</div>
                        <div class="file-size">${formatFileSize(file.size)}</div>
                    </div>
                    <div class="delete-file" onclick="deleteFile('${file.name}')">åˆ é™¤</div>
                `;
                fileListDiv.appendChild(fileItem);
            });
        }
        
        function displayExecutionResult(result) {
            logMessage('æ‰§è¡Œç»“æœ:', 'success');
            if (result.output) {
                logMessage(`è¾“å‡º: ${result.output}`, 'info');
            }
            if (result.memory_free) {
                logMessage(`å‰©ä½™å†…å­˜: ${result.memory_free} å­—èŠ‚`, 'info');
            }
        }
        
        function showProgressBar(show) {
            const progressBar = document.getElementById('progressBar');
            progressBar.style.display = show ? 'block' : 'none';
        }
        
        function updateProgress(percent) {
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = `${percent}%`;
            progressFill.textContent = `${Math.round(percent)}%`;
        }
        
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }
        
        // é¡µé¢å¸è½½æ—¶æ–­å¼€è¿æ¥
        window.addEventListener('beforeunload', () => {
            if (isConnected) {
                disconnectDevice();
            }
        });
        
        // åˆå§‹åŒ–æ—¥å¿—
        logMessage('ESP32æ— çº¿ç¼–ç¨‹å™¨å·²å°±ç»ª', 'info');
        logMessage('ç‚¹å‡»"æ‰«æå¹¶è¿æ¥è®¾å¤‡"å¼€å§‹ä½¿ç”¨', 'info');
        
    </script>
</body>
</html>